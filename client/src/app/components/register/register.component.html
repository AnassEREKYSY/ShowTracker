<section class="auth-shell">
  <div class="auth-card">
    <div class="logo">M</div>
    <h1 class="title">Create account</h1>

    <form [formGroup]="form" (ngSubmit)="submit()">
      <mat-form-field appearance="outline" class="w-100">
        <input matInput data-testid="reg-email" type="email" placeholder="Email" formControlName="email" autocomplete="email"/>
        <mat-error *ngIf="form.controls.email.hasError('required')">Email is required.</mat-error>
        <mat-error *ngIf="form.controls.email.hasError('email')">Enter a valid email.</mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-100">
        <input matInput data-testid="reg-password" [type]="hide ? 'password' : 'text'" placeholder="Password" formControlName="password" autocomplete="new-password" />
        <button type="button" mat-icon-button matSuffix (click)="hide = !hide" aria-label="Toggle password">
          <mat-icon>{{ hide ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        <mat-error *ngIf="form.controls.password.hasError('required')">Password is required.</mat-error>
        <mat-error *ngIf="form.controls.password.hasError('minlength')">Minimum 6 characters.</mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-100">
        <input matInput data-testid="reg-confirm" [type]="hide2 ? 'password' : 'text'" placeholder="Confirm password" formControlName="confirm" autocomplete="new-password" />
        <button type="button" mat-icon-button matSuffix (click)="hide2 = !hide2" aria-label="Toggle password">
          <mat-icon>{{ hide2 ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        <mat-error *ngIf="form.controls.confirm.hasError('required')">Confirmation required.</mat-error>
        <mat-error *ngIf="form.controls.confirm.hasError('passwordMismatch')">Passwords do not match.</mat-error>
      </mat-form-field>

      <button mat-raised-button color="primary" class="w-100" [disabled]="form.invalid || loading">
        <span *ngIf="!loading">Create account</span>
        <mat-progress-spinner *ngIf="loading" diameter="18" mode="indeterminate"></mat-progress-spinner>
      </button>
    </form>

    <div class="divider"></div>
    <p class="muted">
      Already have an account?
      <a routerLink="/auth/login" class="link">Sign in</a>
    </p>

    <p *ngIf="error" class="error">{{ error }}</p>
  </div>
</section>
